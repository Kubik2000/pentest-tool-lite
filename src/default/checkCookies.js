import outcome from '../outcome';

/*
 * https://www.owasp.org/index.php/HttpOnly
 * https://www.owasp.org/index.php/SecureFlag
 */

export default function(result) {
  if (result.response.headers.hasOwnProperty('set-cookie')) {
    const regx = new RegExp('.*(secure; HttpOnly)$', 'i');
    const cookies = result.response.headers['set-cookie'];
    let unsecure = [];
    if (typeof cookies === 'object') {
      unsecure = cookies.filter((cookie) => {
        return !regx.test(cookie);
      });
    }
    if (unsecure.length > 0) {
      outcome.error('default', result.url, 'Missing "secure; httpOnly" flags in cookies!');
    }
  }
  return result;
};
