import checkHttps from './checkHttps.js';
import checkContentSecurityPolicy from './checkContentSecurityPolicy.js';
import checkXXSSProtection from './checkXXSSProtection.js';
import checkXFrameOptions from './checkXFrameOptions.js';
import checkDirectoriesIndexing from './checkDirectoriesIndexing.js';
import getResources from './getResources.js';
import resourcesToDirectories from './resourcesToDirectories.js';

const check = function(url) {
  return new function() {
    return new Promise(function(resolve, reject) {
      const chain = Promise.resolve();

      chain.then(checkHttps(url))
        .then(checkContentSecurityPolicy(url))
        .then(checkXXSSProtection(url))
        .then(checkXFrameOptions(url))
        .then(() => {
          return new Promise(function(subresolve, subreject) {
            const directoryChain = Promise.resolve();
            directoryChain.then(getResources(url))
              .then((result) => { return resourcesToDirectories(result); })
              .then(checkDirectoriesIndexing)
              .then(() => { subresolve(); });
          });
        })
        .then(() => { resolve(); });
    });
  };
};

export default check;
