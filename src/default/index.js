import fetch from './fetch.js';
import fetchWithoutRedirect from './fetchWithoutRedirect.js';
import httpsToHttp from './httpsToHttp.js';
import checkHttps from './checkHttps.js';
import checkXFrameOptions from './checkXFrameOptions.js';
import checkXXSSProtection from './checkXXSSProtection.js';
import getResources from './getResources.js';
import resourcesToDirectories from './resourcesToDirectories.js';
import checkDirectoriesIndexing from './checkDirectoriesIndexing.js';
import checkCookies from './checkCookies.js';

const check = function(url) {
  return new function() {
    return new Promise(function(resolve, reject) {
      const chain = Promise.resolve(url);

      chain.then(() => {
        return Promise.resolve(url)
          .then(httpsToHttp)
          .then(fetchWithoutRedirect)
          .then(checkHttps);
      })
      .then(() => {
        return Promise.resolve(url)
          .then(fetch)
          .then(checkXFrameOptions)
          .then(checkXXSSProtection)
          .then(checkCookies);
      })
      .then(() => {
        return Promise.resolve(url)
          .then(fetch)
          .then(getResources)
          .then(resourcesToDirectories)
          .then(checkDirectoriesIndexing);
      })
      .then(() => { resolve(); });
    });
  };
};

export default check;
