import fetch from '../default/fetch.js';
import parseHtml from '../default/parseHtml.js';
import checkIfWordPress from './checkIfWordPress.js';
import checkAdminPage from './checkAdminPage.js';
import checkGenerator from './checkGenerator.js';
import urlToAdmin from './urlToAdmin.js';

const check = function(url) {
  return new function() {
    return new Promise(function(resolve, reject) {
      const chain = Promise.resolve(url);

      chain.then(fetch)
        .then(checkIfWordPress)
        .then(() => {
          return Promise.resolve(url)
            .then(urlToAdmin)
            .then(fetch)
            .then(checkAdminPage);
        })
        .then(() => {
          return Promise.resolve(url)
            .then(fetch)
            .then(parseHtml)
            .then(checkGenerator);
        })
        .then(() => { resolve(); })
        .catch(() => { console.log('Not a wordpress site!'); resolve(); });
    });
  };
};

export default {
  check: check,
};
