#!/usr/bin/env node

import program from 'commander';
import winston from 'winston';
import run from './run.js';

process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';

const description = [
  'Check your website ( or any other website ) for common vulnerabilities.\n',
  '\n',
  'Checks:\n',
  '  * security https - if http redirects to https\n',
  '  * security cookies - if if cookies has secure and httpOnly flags\n',
  '\n',
  'If you want to run only specific checks, you can use --grep option.\n',
  'Example:\n',
  '$ pentest-tool-lite --grep security https://juffalow.com',
];

program
  .version('0.0.12')
  .usage('[options] <URL>')
  .description(description.join(''))
  .option('--grep [namespace / name]', 'run only selected checks', '')
  .option('-d, --debug', 'debug mode')
  .option('-v, --verbose', 'be more verbose/talkative during the operation')
  .parse(process.argv);

if( program.verbose ) {
  winston.level = 'verbose';
}

if( program.debug ) {
  winston.level = 'debug';
}

if( program.args.length === 0 ) {
  console.error('URL is missing!', 'For help, type pentest-tool-lite --help.');
  process.exit(0);
}

run(program.args[0], program);
