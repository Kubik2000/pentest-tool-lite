import program from 'commander';
import winston from 'winston';

import defaultChecks from './default';
import resourcesChecks from './resources';
import referencesChecks from './references';
import wordpressChecks from './wordpress';

import outcome from './outcome';
import outcomePrintPlain from './outcome/print/plain.js';

process.env.NODE_TLS_REJECT_UNAUTHORIZED = '0';

program
  .version('1.2.0')
  .usage('[options] <URL ...>')
  .description('Description')
  .option('-d, --debug', 'debug mode')
  .option('-v, --verbose', 'be more verbose/talkative during the operation')
  .parse(process.argv);


if( program.verbose ) {
  winston.level = 'verbose';
}

if( program.debug ) {
  winston.level = 'debug';
}

(new Promise(function(resolve, reject) {
  if( !program.args[0].endsWith('/') ) {
    program.args[0] += '/';
  }
  resolve(program.args[0]);
})).then(() => { return defaultChecks(program.args[0]); })
.then(() => { return resourcesChecks(program.args[0]); })
.then(() => { return referencesChecks(program.args[0]); })
.then(() => { return wordpressChecks(program.args[0]); })
.then(() => { return outcome.getMessages(); })
.then(outcomePrintPlain);
