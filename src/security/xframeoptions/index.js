import * as fetch from '../../functions/fetch.js';
import xFrameOptions from './xFrameOptions.js';

export default function(url) {
  return Promise.resolve(url)
    .then(fetch.fetch)
    .then((http) => {
      const result = {
        url: http.url,
        importance: 75,
        messages: [],
        errors: [],
      };
      try {
        xFrameOptions(http);
        result.messages.push('X-Frame-Options header is set!');
        result.messages.push('X-Frame-Options: ' + http.response.headers['x-frame-options']);
      } catch(exception) {
        result.errors.push('X-Frame-Options header is missing!');
        result.errors.push('This header is used to avoid Clickjacking attacks. It indicates whether or not a browser should be allowed to render a page in a <frame> or <iframe>.');
        result.errors.push('For more informations visit [see this page](https://github.com/juffalow/pentest-tool-lite/tree/master/src/security#x-frame-options).');
      }
      return result;
    });
};
