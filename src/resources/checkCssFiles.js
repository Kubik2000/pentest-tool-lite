import fetch from '../default/fetch.js';
import checkMinifiedCss from './checkMinifiedCss.js';
import checkHttpStatus from '../default/checkHttpStatus.js';
import checkCache from './checkCache.js';
import checkXContentTypeOptions from './checkXContentTypeOptions.js';
import outcome from '../outcome';

export default function(urls) {
  return new Promise(function(resolve, reject) {
    let chain = Promise.resolve();

    urls.forEach((url) => {
      chain = chain.then(() => {
        return Promise.resolve(url)
          .then(fetch)
          .then(checkHttpStatus)
          .then(checkMinifiedCss)
          .then(checkCache)
          .then(checkXContentTypeOptions)
          .catch(() => {
            outcome.warning('resources', url, 'Not found!');
          });
      });
    });

    chain.then(() => { resolve(urls); });
  });
};
