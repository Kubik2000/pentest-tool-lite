import fetch from '../default/fetch.js';
import parseHtml from '../functions/parseHtml.js';
import getResources from '../functions/getResources.js';
import onlyJsFiles from './onlyJsFiles.js';
import checkJsFiles from './checkJsFiles.js';
import onlyCssFiles from './onlyCssFiles.js';
import checkCssFiles from './checkCssFiles.js';

const check = function(url) {
  return new function() {
    return new Promise(function(resolve, reject) {
      const chain = Promise.resolve(url);

      chain.then(() => {
        return Promise.resolve(url)
          .then(fetch)
          .then(parseHtml)
          .then(getResources)
          .then(onlyJsFiles)
          .then(checkJsFiles);
      })
      .then(() => {
        return Promise.resolve(url)
          .then(fetch)
          .then(parseHtml)
          .then(getResources)
          .then(onlyCssFiles)
          .then(checkCssFiles);
      })
      .then(() => { resolve(); });
    });
  };
};

export default {
  check: check,
};
