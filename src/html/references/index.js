import * as fetch from '../../functions/fetch';
import parseHtml from '../../functions/parseHtml.js';
import getReferences from '../../functions/getReferences.js';
import checkHttpStatus from '../../default/checkHttpStatus.js';
import error from './error.js';

export default function(url) {
  return Promise.resolve(url)
    .then(fetch.fetch)
    .then(parseHtml)
    .then(getReferences)
    .then((urls) => {
      return Promise.all(urls.map((singleUrl) => {
        return Promise.resolve(singleUrl)
          .then(fetch.fetch)
          .then(checkHttpStatus)
          .catch((result) => {
            if (result === 'Not found!') {
              error(singleUrl, 'Not found!');
            } else if (result === 'Internal server error!') {
              error(singleUrl, 'Internal server error!');
            }
          });
      }));
    })
    .then(() => { return url; });
};
