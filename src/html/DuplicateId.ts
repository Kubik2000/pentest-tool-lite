import { getAnchors, parseHtml, getDuplicates } from '../functions';
import Test from '../Test';

class DuplicateId extends Test {
  protected request: IRequest;

  protected logger: ILogger;

  constructor(request: IRequest, logger: ILogger) {
    super();
    this.request = request;
    this.logger = logger;
  }

  public async run(url: string): Promise<IResult> {
    this.logger.info('Starting Duplicate ID test...');
    const result = await this.request.get(url);
    const duplicates = await getDuplicates(result);

    if (duplicates.length === 0) {
      return this.getResult('Duplicate IDs', 'SUCCESSFUL');
    }

    return this.getResult('Duplicate IDs', 'UNSUCCESSFUL', duplicates.map(duplicate => {
      return this.getResult(`<${duplicate.name} id="${duplicate.attribs.id}" ... />`, 'UNSUCCESSFUL');
    }));
  }
}

export default DuplicateId;
