import * as fetch from '../../functions/fetch';
import parseHtml from '../../functions/parseHtml.js';
import getResources from '../../functions/getResources.js';
import onlyJsFiles from './onlyJsFiles.js';
import onlyAvailable from './available';
import checkMinifiedJs from './minify';
import checkConsoleLog from './console';
import checkCache from '../cache';
import checkXContentTypeOptions from '../xcontenttypeoptions';

export default function(url) {
  return Promise.resolve(url)
    .then(fetch.fetch)
    .then(parseHtml)
    .then(getResources)
    .then(onlyJsFiles)
    .then(onlyAvailable)
    .then((urls) => {
      return Promise.all(urls.map((singleUrl) => {
        return Promise.resolve(singleUrl)
          .then(checkMinifiedJs)
          .then(checkConsoleLog)
          .then(checkCache)
          .then(checkXContentTypeOptions);
      }));
    })
    .then(() => { return url; });
};
