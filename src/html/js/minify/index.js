import * as fetch from '../../../functions/fetch.js';
import checkHttpStatus from '../../../default/checkHttpStatus.js';
import checkMinifiedJs from './minify.js';
import error from './error.js';

export default function(javascripts) {
  return new Promise(function(resolve, reject) {
    let chain = Promise.resolve();

    javascripts.forEach((url) => {
      chain = chain.then(() => {
        return Promise.resolve(url)
          .then(fetch.fetch)
          .then(checkHttpStatus)
          .then(checkMinifiedJs)
          .then((err) => {
            err.length > 0 && error(url, err);
          })
          .catch((err) => {
            error(url, 'Not found!');
          });
      });
    });

    chain.then(() => { resolve(javascripts); });
  });
};
