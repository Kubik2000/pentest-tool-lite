import sinon from 'sinon';
import outcome from '../../src/outcome';
import checkDirectoryIndexing from '../../src/default/checkDirectoryIndexing.js';

describe('test checkDirectoryIndexing', function() {
  let sandbox;

  beforeEach(function() {
    sandbox = sinon.sandbox.create();
    sandbox.stub(outcome, 'warning');
    sandbox.stub(outcome, 'error');
  });

  afterEach(function() {
    sandbox.restore();
  });

  it('should log error if directory indexing is enabled', () => {
    const result = {
      body: '<html><head><title>Index of folder</title></head><body><h1>Index of folder</h1></body></html>',
    };

    checkDirectoryIndexing(result);

    sinon.assert.calledOnce(outcome.error);
  });

  it('should not log anything', () => {
    const result = {
      body: '<html><head><title>No index</title></head><body><h1>No index</h1></body></html>',
    };

    checkDirectoryIndexing(result);

    sinon.assert.notCalled(outcome.warning);
    sinon.assert.notCalled(outcome.error);
  });
});
