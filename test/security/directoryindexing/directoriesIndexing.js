import sinon from 'sinon';
import * as fetch from '../../../src/functions/fetch.js';
import checkDirectoriesIndexing from '../../../src/security/directoryindexing/directoriesIndexing.js';

describe('security', function() {
  describe('test directoriesIndexing promise', function() {
    let sandbox;

    beforeEach(function() {
      sandbox = sinon.sandbox.create();
    });

    afterEach(function() {
      sandbox.restore();
    });

    it('should fetch site data', () => {
      const result = {
        body: '<html><head><title>Index of folder</title></head><body><h1>Index of folder</h1></body></html>',
      };

      sandbox.stub(fetch, 'fetch').returns(result);

      return new Promise((resolve, reject) => {
        resolve([ 'https://www.juffalow.com/directory/', 'https://www.juffalow.com/directory/directory/' ]);
        })
        .then(checkDirectoriesIndexing)
        .then((url) => {
          sinon.assert.calledTwice(fetch.fetch);
        });
    });
  });
});
