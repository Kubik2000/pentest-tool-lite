import chai from 'chai';
const expect = chai.expect;
import checkCookies from '../../../src/security/cookies/cookies.js';

describe('security', function() {
  describe('test cookies function', function() {
    it('should throw error if secure flag is missing', () => {
      const result = {
        response: {
          headers: {
            'set-cookie': [
              'some-token',
              'another-cookie-text; HttpOnly',
            ],
          },
        },
      };

      expect(checkCookies.bind(null, result)).to.throw();
    });

    it('should throw error if any cookie does not end with secure, HttpOnly', () => {
      const result = {
        response: {
          headers: {
            'set-cookie': [
              'some-token; secure; HttpOnly',
              'another-cookie-text;',
              'whatever; secure; HttpOnly',
            ],
          },
        },
      };
      expect(checkCookies.bind(null, result)).to.throw();
    });

    it('should return without throwing error', () => {
      const result = {
        response: {
          headers: {
            'set-cookie': [
              'some-token; secure; HttpOnly',
              'another-cookie-text; secure; HttpOnly',
            ],
          },
        },
      };

      expect(checkCookies.bind(null, result)).to.not.throw();
    });
  });
});
