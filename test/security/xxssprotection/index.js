import sinon from 'sinon';
import chai from 'chai';
const expect = chai.expect;
import * as fetch from '../../../src/functions/fetch.js';
import checkXXSSProtection from '../../../src/security/xxssprotection';

describe('security', function() {
  describe('text X-XSS-Protection promise', function() {
    let sandbox;

    beforeEach(function() {
      sandbox = sinon.sandbox.create();
    });

    afterEach(function() {
      sandbox.restore();
    });

    it('should return original URL even if no https', () => {
      const result = {
        response: {
          headers: {},
        },
      };

      sandbox.stub(fetch, 'fetch').returns(result);

      return new Promise((resolve, reject) => {
        resolve('https://www.juffalow.com');
        })
        .then(checkXXSSProtection)
        .then((r) => {
          expect(r).to.equal('https://www.juffalow.com');
        });
    });

    it('should return original URL', () => {
      const result = {
        response: {
          headers: {
            'x-xss-protection': '1;mode=block',
          },
        },
      };

      sandbox.stub(fetch, 'fetch').returns(result);

      Promise.resolve('https://www.juffalow.com')
        .then(checkXXSSProtection)
        .then((url) => {
          expect(url).to.equal('https://www.juffalow.com');
        });
    });
  });
});
