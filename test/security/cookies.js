import chai from 'chai';
const expect = chai.expect;
import winston from 'winston';
import Cookies from '../../src/security/Cookies';

describe('test Cookies', function() {
  it('incorrect cookies', () => {
    const logger = winston.createLogger({
      transports: [ new winston.transports.Console({ level: 'error'}) ]
    });
    const request = {
      get: function(url) {
        return {
          response: {
            headers: {
              'set-cookie': [
                'some-token',
                'another-cookie-text; HttpOnly',
              ],
            },
          },
        };
      }
    };

    return (new Cookies(request, logger)).execute('https://example.com/').then((result) => {
      expect(result.content).to.equal('https://example.com/');
      expect(result.resultType).to.equal(2);
    });
  });

  it('correct cookies', () => {
    const logger = winston.createLogger({
      transports: [ new winston.transports.Console({ level: 'error'}) ]
    });
    const request = {
      get: function(url) {
        return {
          response: {
            headers: {
              'set-cookie': [
                'some-token; secure; httponly',
                'another-cookie-text; secure; HttpOnly',
              ],
            },
          },
        };
      }
    };

    return (new Cookies(request, logger)).execute('https://example.com/').then((result) => {
      expect(result.content).to.equal('https://example.com/');
      expect(result.resultType).to.equal(1);
    });
  });
});
