import chai from 'chai';
const expect = chai.expect;
import winston from 'winston';
import { TYPE_OK, TYPE_ERROR } from '../../src/pentest/Result';
import XFrameOptions from '../../src/security/XFrameOptions';

describe('test X-Frame-Options', function() {
  it('correct X-Frame-Options header', () => {
    const logger = winston.createLogger({
      transports: [ new winston.transports.Console({ level: 'error'}) ]
    });
    const request = {
      get: function(url) {
        return {
          response: {
            headers: {
              'x-frame-options': 'SAMEORIGIN',
            },
          },
        };
      }
    };

    return (new XFrameOptions(request, logger)).execute('https://example.com/').then((result) => {
      expect(result.content).to.equal('https://example.com/');
      expect(result.resultType).to.equal(TYPE_OK);
    });
  });

  it('missing X-Frame-Options header', () => {
    const logger = winston.createLogger({
      transports: [ new winston.transports.Console({ level: 'error'}) ]
    });
    const request = {
      get: function(url) {
        return {
          response: {
            headers: {},
          },
        };
      }
    };

    return (new XFrameOptions(request, logger)).execute('https://example.com/').then((result) => {
      expect(result.content).to.equal('https://example.com/');
      expect(result.resultType).to.equal(TYPE_ERROR);
    });
  });
});
