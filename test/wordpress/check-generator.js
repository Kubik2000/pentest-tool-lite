import sinon from 'sinon';
import outcome from '../../src/outcome';
import checkGenerator from '../../src/wordpress/checkGenerator.js';

describe('test checkGenerator', function() {
  let sandbox;

  beforeEach(function() {
    sandbox = sinon.sandbox.create();
    sandbox.stub(outcome, 'warning');
  });

  afterEach(function() {
    sandbox.restore();
  });

  it('should log warning if generator meta tag is present', () => {
    const html = [
      {
        type: 'tag',
        name: 'html',
        children: [
          {
            type: 'tag',
            name: 'head',
            children: [
              {
                type: 'tag',
                name: 'title',
              },
              {
                type: 'tag',
                name: 'meta',
                attribs: {
                    name: 'generator',
                    content: 'WordPress X.Y.Z',
                },
              },
            ],
          },
          {
            type: 'tag',
            name: 'body',
            children: [],
          },
        ],
      },
    ];

    checkGenerator(html);

    sinon.assert.calledOnce(outcome.warning);
  });
});
