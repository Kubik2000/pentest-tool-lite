import sinon from 'sinon';
import chai from 'chai';
const expect = chai.expect;
import * as fetch from '../../../src/functions/fetch.js';
import checkGenerator from '../../../src/wordpress/generator';

describe('wordpress', function() {
  describe('test generator promise', function() {
    let sandbox;

    beforeEach(function() {
      sandbox = sinon.sandbox.create();
    });

    afterEach(function() {
      sandbox.restore();
    });

    it('should return array of results, with one result, that contains errors', () => {
      const html = {
        url: 'https://juffalow.com/',
        body: '<html><head><meta name="generator" content="WordPress X.Y.Z" /></head><body><p>Text</p></body></html>',
      };

      sandbox.stub(fetch, 'fetch').returns(html);

      return checkGenerator('https://juffalow.com/')
        .then((r) => {
          expect(r.messages.length).to.equal(0);
          expect(r.errors.length).to.equal(2);
        });
    });
  });
});
