import sinon from 'sinon';
import chai from 'chai';
const expect = chai.expect;
import * as fetch from '../../../src/functions/fetch.js';
import checkAdmin from '../../../src/wordpress/admin';

describe('wordpress', function() {
  describe('test admin promise', function() {
    let sandbox;

    beforeEach(function() {
      sandbox = sinon.sandbox.create();
    });

    afterEach(function() {
      sandbox.restore();
    });

    it('should return original URL even if admin is available', () => {
      const html = {
        body: '<html><head><title>Log in</title></head><body><form name="loginform" id="loginform" action="https://www.juffalow.com/wp-login.php" method="post"><input type="text" name="log" id="user_login" class="input" value="" size="20" /></label><input type="password" name="pwd" id="user_pass" class="input" value="" size="20" /></label></form></body></html>',
      };

      sandbox.stub(fetch, 'fetch').returns(html);

      return new Promise((resolve, reject) => {
        resolve('https://www.juffalow.com');
        })
        .then(checkAdmin)
        .then((r) => {
          expect(r).to.equal('https://www.juffalow.com');
        });
    });
  });
});
